<% layout('layout') %>

<style>
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:14px;}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  .input{padding:10px;border-radius:12px;border:1px solid #e5e7eb;}
  table{width:100%;border-collapse:collapse;}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;}
  .btn-sm{padding:8px 10px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;text-decoration:none;display:inline-block;}
  .btn-sm:hover{border-color:#16a34a;color:#16a34a;}
  .muted{color:#6b7280;}
</style>

<div class="row" style="justify-content:space-between;">
  <div>
    <h1>Usuários</h1>
    <div class="muted">Cadastre perfis: Direção, RH, Compras e Manutenção.</div>
  </div>
  <a class="btn-sm" href="/usuarios/novo">+ Novo Usuário</a>
</div>

<div class="card" style="margin-top:12px;">
  <form class="row" method="GET" action="/usuarios">
    <input class="input" name="q" value="<%= q || '' %>" placeholder="Buscar por nome ou e-mail" />
    <select class="input" name="role">
      <option value="">Todos os perfis</option>
      <% ROLES.forEach(r => { %>
        <option value="<%= r.key %>" <%= (role === r.key) ? "selected" : "" %>><%= r.label %></option>
      <% }) %>
    </select>
    <button class="btn-sm" type="submit">Filtrar</button>
    <a class="btn-sm" href="/usuarios">Limpar</a>
  </form>
</div>

<div class="card" style="margin-top:12px;">
  <table>
    <thead>
      <tr>
        <th>#</th><th>Nome</th><th>E-mail</th><th>Perfil</th><th>Criado</th><th style="text-align:right;">Ações</th>
      </tr>
    </thead>
    <tbody>
      <% if (!lista || !lista.length) { %>
        <tr><td colspan="6" class="muted">Nenhum usuário encontrado.</td></tr>
      <% } %>
      <% (lista || []).forEach(u => { %>
        <tr>
          <td><%= u.id %></td>
          <td><%= u.name %></td>
          <td><%= u.email %></td>
          <td><%= (u.role || '').toUpperCase() %></td>
          <td><%= u.created_at ? fmtBR(u.created_at) : '-' %></td>
          <td style="text-align:right;">
            <a class="btn-sm" href="/usuarios/<%= u.id %>/editar">Editar</a>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
