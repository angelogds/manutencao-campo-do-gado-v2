<!-- views/login.ejs -->
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><%= title || "Login ‚Ä¢ Campo do Gado" %></title>

  <link rel="stylesheet" href="/css/app.css" />

  <style>
    :root{
      --action-600: #16a34a;
      --action-700: #15803d;
      --border: #e5e7eb;
      --text: #0f172a;
      --muted:#64748b;
    }

    /* fundo premium com imagem + overlay */
    body{
      min-height:100vh;
      background:
        linear-gradient(180deg, rgba(10,90,63,.78), rgba(10,90,63,.72)),
        url("/img/login-bg.webp");
      background-size:cover;
      background-position:center;
      background-attachment:fixed;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .login-wrap{
      width:100%;
      max-width:520px;
    }

    .panel{
      background: rgba(255,255,255,.92);
      border:1px solid rgba(229,231,235,.9);
      border-radius:22px;
      padding:22px;
      box-shadow: 0 24px 60px rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:14px;
    }
    .brand-badge{
      width:44px;height:44px;
      border-radius:16px;
      background: linear-gradient(180deg, #0a5a3f, #0e6a45);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:900;
      letter-spacing:.02em;
      box-shadow: 0 10px 20px rgba(10,90,63,.25);
      flex:0 0 auto;
    }
    .brand-title{
      font-weight:900;
      font-size:20px;
      margin:0;
      color:var(--text);
      line-height:1.1;
    }
    .brand-sub{
      margin:4px 0 0;
      color:var(--muted);
      font-weight:700;
      font-size:13px;
    }

    .alert{
      border-radius:16px;
      padding:12px 14px;
      border:1px solid var(--border);
      background:#fff;
      font-weight:800;
      margin:12px 0 14px;
    }
    .alert-error{ border-color:#fecaca; background:#fff5f5; color:#7f1d1d; }
    .alert-warn{ border-color:#fed7aa; background:#fff7ed; color:#9a3412; }
    .alert-success{ border-color:#bbf7d0; background:#f0fdf4; color:#14532d; }
    .alert small{ display:block; margin-top:6px; font-weight:700; opacity:.9; }

    .field{
      margin-top:12px;
    }
    .label{
      font-size:12px;
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:6px;
    }
    .input{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--border);
      border-radius:14px;
      outline:none;
      font:inherit;
      background:#fff;
    }
    .input:focus{
      border-color: rgba(22,163,74,.55);
      box-shadow:0 0 0 3px rgba(22,163,74,.12);
    }

    .pass-row{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .pass-row .input{ flex:1; }

    .icon-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:46px; height:46px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      transition:.15s ease;
    }
    .icon-btn:hover{
      border-color: rgba(22,163,74,.35);
      background:#ecfdf5;
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    .check{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      color:#334155;
      user-select:none;
    }
    .check input{ width:18px; height:18px; }

    .hint{
      color:var(--muted);
      font-weight:700;
      font-size:12px;
    }

    .btn-primary{
      width:100%;
      margin-top:14px;
      background: var(--action-600);
      border:1px solid var(--action-600);
      color:#fff;
      padding:12px 14px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      transition:.15s ease;
      font-size:15px;
    }
    .btn-primary:hover{
      background: var(--action-700);
      border-color: var(--action-700);
      transform: translateY(-1px);
    }

    .footer{
      margin-top:12px;
      text-align:center;
      color: rgba(255,255,255,.85);
      font-weight:800;
      font-size:12px;
      text-shadow: 0 2px 12px rgba(0,0,0,.35);
    }
  </style>
</head>

<body>
  <div class="login-wrap">
    <div class="panel">
      <div class="brand">
        <div class="brand-badge">CG</div>
        <div>
          <p class="brand-title">Campo do Gado</p>
          <p class="brand-sub">Manuten√ß√£o Industrial ‚Ä¢ Sistema V2</p>
        </div>
      </div>

      <!-- ALERTAS (opcionais) -->
      <% if (flash?.error?.length) { %>
        <div class="alert alert-error"><%= flash.error[0] %></div>
      <% } %>

      <% if (lockout) { %>
        <div class="alert alert-warn">
          Conta temporariamente bloqueada.
          <small>Tente novamente em <%= lockout.remainingSeconds %>s.</small>
        </div>
      <% } else if (attemptsLeft !== undefined && attemptsLeft !== null && attemptsLeft <= 2) { %>
        <div class="alert alert-warn">
          Aten√ß√£o: restam <%= attemptsLeft %> tentativa(s).
          <small>Por seguran√ßa, o sistema bloqueia ap√≥s exceder o limite.</small>
        </div>
      <% } %>

      <form id="loginForm" method="POST" action="/login" autocomplete="on">
        <div class="field">
          <div class="label">E-mail</div>
          <input class="input" name="email" type="email" autocomplete="username" required
                 placeholder="seuemail@empresa.com"
                 value="<%= (rememberedEmail || '') %>" />
        </div>

        <div class="field">
          <div class="label">Senha</div>

          <div class="pass-row">
            <input id="password" class="input" name="password" type="password" autocomplete="current-password" required
                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            <button id="togglePass" class="icon-btn" type="button" aria-label="Mostrar/ocultar senha" title="Mostrar/ocultar senha">
              üëÅÔ∏è
            </button>
          </div>
        </div>

        <div class="row">
          <label class="check">
            <input id="rememberMe" type="checkbox" />
            Lembrar de mim
          </label>

          <div class="hint">
            <span>Prote√ß√£o anti-tentativas ativada</span>
          </div>
        </div>

        <button class="btn-primary" type="submit">Entrar no Sistema</button>
      </form>
    </div>

    <div class="footer">¬© <%= new Date().getFullYear() %> Campo do Gado</div>
  </div>

  <script>
    // Mostrar/ocultar senha
    (function(){
      const pass = document.getElementById('password');
      const btn = document.getElementById('togglePass');
      if(!pass || !btn) return;

      btn.addEventListener('click', () => {
        const isPass = pass.type === 'password';
        pass.type = isPass ? 'text' : 'password';
        btn.textContent = isPass ? 'üôà' : 'üëÅÔ∏è';
      });
    })();

    // "Lembrar de mim" (client-side): salva email no localStorage
    (function(){
      const emailInput = document.querySelector('input[name="email"]');
      const remember = document.getElementById('rememberMe');
      if(!emailInput || !remember) return;

      const saved = localStorage.getItem('cg_remember_email');
      if(saved){
        emailInput.value = emailInput.value || saved;
        remember.checked = true;
      }

      document.getElementById('loginForm')?.addEventListener('submit', () => {
        if(remember.checked){
          localStorage.setItem('cg_remember_email', emailInput.value || '');
        } else {
          localStorage.removeItem('cg_remember_email');
        }
      });
    })();
  </script>
</body>
</html>
