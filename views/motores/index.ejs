<% layout('layout') %>

<div class="page">
  <div class="page-header">
    <h2>Motores</h2>
    <a class="btn" href="/motores/new">+ Cadastrar Motor</a>
  </div>

  <div class="card">
    <form method="GET" action="/motores" class="row" style="display:flex; gap:10px; flex-wrap:wrap;">
      <input name="q" placeholder="Buscar (código, descrição, local)" value="<%= filtros.q %>" />
      <select name="origem">
        <option value="">Origem (todas)</option>
        <option value="RECICLAGEM" <%= filtros.origem==='RECICLAGEM'?'selected':'' %>>RECICLAGEM</option>
        <option value="FRIGORIFICO" <%= filtros.origem==='FRIGORIFICO'?'selected':'' %>>FRIGORÍFICO</option>
      </select>

      <select name="status">
        <option value="">Status (todos)</option>
        <option value="EM_USO" <%= filtros.status==='EM_USO'?'selected':'' %>>EM_USO</option>
        <option value="ENVIADO_REBOB" <%= filtros.status==='ENVIADO_REBOB'?'selected':'' %>>ENVIADO_REBOB</option>
        <option value="RETORNOU" <%= filtros.status==='RETORNOU'?'selected':'' %>>RETORNOU</option>
        <option value="RESERVA" <%= filtros.status==='RESERVA'?'selected':'' %>>RESERVA</option>
      </select>

      <input name="potencia" placeholder="Potência (CV)" value="<%= filtros.potencia %>" style="width:140px;" />
      <button class="btn" type="submit">Filtrar</button>
      <a class="btn btn-ghost" href="/motores">Limpar</a>
    </form>
  </div>

  <div class="card">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Código</th>
          <th>Descrição</th>
          <th>Potência</th>
          <th>RPM</th>
          <th>Origem</th>
          <th>Status</th>
          <th style="width:120px;">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% if (!lista || !lista.length) { %>
          <tr><td colspan="8">Nenhum motor encontrado.</td></tr>
        <% } %>

        <% lista.forEach(m => { %>
          <tr>
            <td><%= m.id %></td>
            <td><%= m.codigo || '-' %></td>
            <td><%= m.descricao %></td>
            <td><%= m.potencia_cv ?? '-' %></td>
            <td><%= m.rpm ?? '-' %></td>
            <td><%= m.origem_unidade %></td>
            <td><%= m.status %></td>
            <td>
              <a class="btn btn-sm" href="/motores/<%= m.id %>">Ver</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
