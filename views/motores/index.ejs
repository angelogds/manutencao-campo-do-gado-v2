<% layout('layout') %>

<div class="page-head">
  <div>
    <h1>Motores</h1>
    <p class="muted">Cadastro e acompanhamento de motores (rebobinamento / reserva / em uso).</p>
  </div>

  <div style="display:flex; gap:10px;">
    <a class="btn btn-green" href="/motores/new">+ Cadastrar Motor</a>
  </div>
</div>

<div class="card" style="margin-bottom:14px;">
  <form method="GET" action="/motores" class="row" style="flex-wrap:wrap;">
    <div style="flex:2; min-width:260px;">
      <div class="label">Busca</div>
      <input name="q" placeholder="Buscar (código, descrição, local)" value="<%= filtros.q %>" />
    </div>

    <div style="flex:1; min-width:200px;">
      <div class="label">Origem</div>
      <select name="origem">
        <option value="">Origem (todas)</option>
        <option value="RECICLAGEM" <%= filtros.origem==='RECICLAGEM'?'selected':'' %>>RECICLAGEM</option>
        <option value="FRIGORIFICO" <%= filtros.origem==='FRIGORIFICO'?'selected':'' %>>FRIGORÍFICO</option>
      </select>
    </div>

    <div style="flex:1; min-width:220px;">
      <div class="label">Status</div>
      <select name="status">
        <option value="">Status (todos)</option>
        <option value="EM_USO" <%= filtros.status==='EM_USO'?'selected':'' %>>EM_USO</option>
        <option value="ENVIADO_REBOB" <%= filtros.status==='ENVIADO_REBOB'?'selected':'' %>>ENVIADO_REBOB</option>
        <option value="RETORNOU" <%= filtros.status==='RETORNOU'?'selected':'' %>>RETORNOU</option>
        <option value="RESERVA" <%= filtros.status==='RESERVA'?'selected':'' %>>RESERVA</option>
      </select>
    </div>

    <div style="width:160px;">
      <div class="label">Potência (CV)</div>
      <input name="potencia" placeholder="Ex: 5" value="<%= filtros.potencia %>" />
    </div>

    <div style="display:flex; gap:10px; align-items:flex-end;">
      <button class="btn" type="submit">Filtrar</button>
      <a class="btn btn-ghost" href="/motores">Limpar</a>
    </div>
  </form>
</div>

<div class="card">
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Código</th>
          <th>Descrição</th>
          <th>Potência</th>
          <th>RPM</th>
          <th>Origem</th>
          <th>Status</th>
          <th style="width:120px;">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% if (!lista || !lista.length) { %>
          <tr><td colspan="8">Nenhum motor encontrado.</td></tr>
        <% } else { %>
          <% lista.forEach(m => { %>
            <tr>
              <td><%= m.id %></td>
              <td><%= m.codigo || '-' %></td>
              <td class="td-clip" title="<%= m.descricao %>"><%= m.descricao %></td>
              <td><%= m.potencia_cv ?? '-' %></td>
              <td><%= m.rpm ?? '-' %></td>
              <td><%= m.origem_unidade %></td>
              <td>
                <% if (m.status === 'ENVIADO_REBOB') { %>
                  <span class="pill-tag pill-amber">ENVIADO_REBOB</span>
                <% } else if (m.status === 'RETORNOU') { %>
                  <span class="pill-tag pill-green">RETORNOU</span>
                <% } else if (m.status === 'RESERVA') { %>
                  <span class="pill-tag pill-gray">RESERVA</span>
                <% } else { %>
                  <span class="pill-tag pill-blue"><%= m.status %></span>
                <% } %>
              </td>
              <td>
                <a class="btn btn-sm" href="/motores/<%= m.id %>">Ver</a>
              </td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>
</div>
