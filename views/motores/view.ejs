<% layout('layout') %>

<div class="page">
  <div class="page-header">
    <h2>Motor #<%= motor.id %></h2>
    <a class="btn btn-ghost" href="/motores">Voltar</a>
  </div>

  <div class="card" style="display:grid; gap:8px;">
    <div><b>Código:</b> <%= motor.codigo || '-' %></div>
    <div><b>Descrição:</b> <%= motor.descricao %></div>
    <div style="display:flex; gap:18px; flex-wrap:wrap;">
      <div><b>Potência (CV):</b> <%= motor.potencia_cv ?? '-' %></div>
      <div><b>RPM:</b> <%= motor.rpm ?? '-' %></div>
      <div><b>Origem:</b> <%= motor.origem_unidade %></div>
      <div><b>Status:</b> <%= motor.status %></div>
    </div>
    <div><b>Local:</b> <%= motor.local_instalacao || '-' %></div>

    <div style="display:flex; gap:18px; flex-wrap:wrap;">
      <div><b>Empresa Rebob:</b> <%= motor.empresa_rebob || '-' %></div>
      <div><b>Motorista Saída:</b> <%= motor.motorista_saida || '-' %></div>
      <div><b>Data Saída:</b> <%= motor.data_saida || '-' %></div>
    </div>

    <div style="display:flex; gap:18px; flex-wrap:wrap;">
      <div><b>Motorista Retorno:</b> <%= motor.motorista_retorno || '-' %></div>
      <div><b>Data Retorno:</b> <%= motor.data_retorno || '-' %></div>
    </div>

    <div><b>Observação:</b> <%= motor.observacao || '-' %></div>
  </div>

  <div class="grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin-top:14px;">
    <div class="card">
      <h3 style="margin-top:0;">Enviar para rebobinamento</h3>
      <form method="POST" action="/motores/<%= motor.id %>/enviar" style="display:grid; gap:10px;">
        <label>Empresa *</label>
        <input name="empresa_rebob" required placeholder="Ex: Rebobinadora X" />

        <label>Motorista</label>
        <input name="motorista_saida" placeholder="Nome do motorista" />

        <label>Observação</label>
        <input name="observacao" placeholder="Ex: saiu com urgência..." />

        <button class="btn" type="submit">Registrar Saída</button>
      </form>
    </div>

    <div class="card">
      <h3 style="margin-top:0;">Registrar retorno</h3>
      <form method="POST" action="/motores/<%= motor.id %>/retorno" style="display:grid; gap:10px;">
        <label>Motorista</label>
        <input name="motorista_retorno" placeholder="Nome do motorista" />

        <label>Observação</label>
        <input name="observacao" placeholder="Ex: retornou testado..." />

        <button class="btn" type="submit">Registrar Retorno</button>
      </form>
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <h3 style="margin-top:0;">Histórico</h3>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Tipo</th>
          <th>Quando</th>
          <th>Detalhes</th>
        </tr>
      </thead>
      <tbody>
        <% if (!eventos || !eventos.length) { %>
          <tr><td colspan="4">Sem histórico.</td></tr>
        <% } %>

        <% eventos.forEach(e => { %>
          <tr>
            <td><%= e.id %></td>
            <td><%= e.tipo %></td>
            <td><%= e.created_at %></td>
            <td>
              <% if (e.payloadObj) { %>
                <pre style="white-space:pre-wrap; margin:0;"><%= JSON.stringify(e.payloadObj, null, 2) %></pre>
              <% } else { %>
                -
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
