<% layout('layout') %>

<style>
  .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  .spacer{ flex:1; }
  .card{ background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:14px; }
  .muted{ color:#6b7280; }
  .btn-sm{ padding:8px 10px; border-radius:12px; font-weight:900; border:1px solid #e5e7eb; background:#fff; cursor:pointer; }
  .btn-sm:hover{ border-color:#10b981; color:#065f46; background:#ecfdf5; }
  .pill{ display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; border:1px solid #e5e7eb; background:#f9fafb; font-weight:900; font-size:12px; }
  table{ width:100%; border-collapse:separate; border-spacing:0; background:#fff; border:1px solid #e5e7eb; border-radius:16px; overflow:hidden; }
  th,td{ padding:10px 12px; border-bottom:1px solid #eef2f7; }
  th{ text-align:left; font-size:12px; color:#6b7280; letter-spacing:.04em; }
  tr:last-child td{ border-bottom:none; }
  select{ padding:8px 10px; border-radius:12px; border:1px solid #e5e7eb; }
  select:focus{ border-color:#10b981; box-shadow:0 0 0 3px rgba(16,185,129,.15); outline:none; }
</style>

<div class="row">
  <div>
    <h1>Solicitação #<%= solicitacao.id %></h1>
    <div class="muted">Criada em: <%= solicitacao.created_at ? fmtBR(solicitacao.created_at) : '-' %></div>
  </div>
  <div class="spacer"></div>

  <div class="pill">
    Status: <%= String(solicitacao.status || '').toUpperCase() %>
  </div>

  <a class="btn-sm" href="/solicitacoes">Voltar</a>
</div>

<div style="height:12px"></div>

<div class="card">
  <div class="row">
    <div style="flex:1; min-width:220px;">
      <div class="muted">Solicitante</div>
      <div style="font-weight:900;"><%= solicitacao.solicitante || '-' %></div>
    </div>
    <div style="flex:1; min-width:220px;">
      <div class="muted">Setor</div>
      <div style="font-weight:900;"><%= solicitacao.setor || '-' %></div>
    </div>
    <div style="flex:2; min-width:220px;">
      <div class="muted">Observação</div>
      <div style="font-weight:700;"><%= solicitacao.observacao || '-' %></div>
    </div>
  </div>

  <div style="height:12px"></div>

  <form action="/solicitacoes/<%= solicitacao.id %>/status" method="POST" class="row">
    <div>
      <div class="muted" style="font-weight:900; font-size:12px;">Atualizar status</div>
      <select name="status">
        <% const st = String(solicitacao.status||'aberta').toLowerCase(); %>
        <option value="aberta" <%= st==='aberta'?'selected':'' %>>aberta</option>
        <option value="cotacao" <%= st==='cotacao'?'selected':'' %>>cotacao</option>
        <option value="aprovada" <%= st==='aprovada'?'selected':'' %>>aprovada</option>
        <option value="comprada" <%= st==='comprada'?'selected':'' %>>comprada</option>
        <option value="recebida" <%= st==='recebida'?'selected':'' %>>recebida</option>
        <option value="cancelada" <%= st==='cancelada'?'selected':'' %>>cancelada</option>
      </select>
    </div>
    <div style="align-self:flex-end;">
      <button class="btn-sm" type="submit">Salvar</button>
    </div>
  </form>
</div>

<div style="height:12px"></div>

<table>
  <thead>
    <tr>
      <th>Descrição</th>
      <th style="width:120px;">Qtd</th>
      <th style="width:120px;">Un</th>
    </tr>
  </thead>
  <tbody>
    <% if (!solicitacao.itens || !solicitacao.itens.length) { %>
      <tr><td colspan="3" class="muted">Sem itens.</td></tr>
    <% } %>
    <% (solicitacao.itens || []).forEach(it => { %>
      <tr>
        <td><strong><%= it.descricao %></strong></td>
        <td><%= it.quantidade %></td>
        <td><%= it.unidade %></td>
      </tr>
    <% }) %>
  </tbody>
</table>
