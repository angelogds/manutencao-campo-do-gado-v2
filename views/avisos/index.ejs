<% layout('layout') %>

<div class="page-head">
  <div>
    <h1>Avisos</h1>
    <p class="muted">Mural de informações relevantes para reciclagem, operação e manutenção.</p>
  </div>
</div>

<% if (canPublishAviso) { %>
  <div class="card" style="margin-bottom:16px;">
    <div class="label">Novo aviso</div>
    <form method="POST" action="/avisos" style="margin-top:12px;">
      <div class="grid-2">
        <input class="input" name="titulo" placeholder="Título do aviso" required>
      </div>
      <div style="margin-top:10px;">
        <textarea class="input" name="mensagem" placeholder="Mensagem do aviso" style="min-height:110px;" required></textarea>
      </div>
      <div class="grid-2" style="margin-top:10px; align-items:end; gap:10px;">
        <div>
          <label style="display:block; font-size:12px; color:#64748b; margin-bottom:4px;">Tempo de exibição</label>
          <select class="input" name="dias_visiveis">
            <option value="7">7 dias</option>
            <option value="15">15 dias</option>
            <option value="30">30 dias</option>
          </select>
        </div>
        <div>
          <button class="btn btn-green" type="submit">Publicar aviso</button>
        </div>
      </div>
    </form>
  </div>
<% } %>

<div class="card">
  <div class="label">Mural</div>
  <% if (!avisos || avisos.length === 0) { %>
    <p class="muted" style="margin-top:10px;">Sem avisos publicados.</p>
  <% } else { %>
    <div style="display:grid; gap:10px; margin-top:12px;">
      <% avisos.forEach(function(a) { %>
        <div style="border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px;">
          <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px;">
            <div style="font-weight:800;"><%= a.titulo %></div>
            <% if (canPublishAviso) { %>
              <form method="POST" action="/avisos/<%= a.id %>/delete" onsubmit="return confirm('Excluir este aviso?');" style="margin:0;">
                <button type="submit" class="btn btn-red" style="padding:6px 10px;">Excluir</button>
              </form>
            <% } %>
          </div>
          <div class="muted" style="margin-top:4px; white-space:pre-wrap;"><%= a.mensagem %></div>
          <div class="muted-xs" style="margin-top:6px;">
            por <%= a.autor_nome || 'Sistema' %> • <%= fmtBR(a.created_at) %>
            <% if (a.visible_until) { %> • visível até <%= fmtBR(a.visible_until) %><% } %>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>
