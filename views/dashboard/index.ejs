<% layout('layout') %>

<div class="page-head">
  <div>
    <h1>Dashboard</h1>
    <p class="muted">Vis√£o geral do sistema (V2).</p>
  </div>
</div>

<!-- üîî ALERTA MOTORES EM REBOBINAMENTO -->
<% if (cards?.motores_conserto && cards.motores_conserto > 0) { %>
  <div class="card" style="margin-bottom:16px; border-color:#fed7aa; background:#fff7ed;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
      <div>
        <div style="font-weight:900;">
          Alerta: <%= cards.motores_conserto %> motor(es) em rebobinamento
          <span class="pill-tag pill-amber" style="margin-left:8px;">ENVIADO_REBOB</span>
        </div>

        <% if (cards.motor_mais_antigo) { %>
          <div class="muted" style="margin-top:4px;">
            Motor mais antigo fora:
            <strong>#<%= cards.motor_mais_antigo.id %></strong>
            - <%= cards.motor_mais_antigo.descricao %>
            (<%= cards.motor_mais_antigo.dias %> dias)
          </div>
        <% } %>
      </div>

      <a class="btn btn-green btn-sm" href="/motores?status=ENVIADO_REBOB">
        Ver motores
      </a>
    </div>
  </div>
<% } %>

<div class="grid-2" style="grid-template-columns:repeat(3,minmax(0,1fr)); gap:14px;">

  <!-- OS -->
  <div class="card">
    <div class="label">Ordem de Servi√ßo</div>
    <div style="font-size:22px; font-weight:900; margin-top:6px;">
      Abrir / Acompanhar
    </div>
    <div class="muted" style="margin-top:6px;">
      Abertas, em andamento e conclu√≠das
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;">
      <span class="pill-tag pill-amber">
        Abertas: <%= (cards?.os_abertas ?? 0) %>
      </span>
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:14px;">
      <a class="btn btn-green btn-sm" href="/os/nova">Abrir OS</a>
      <a class="btn btn-ghost btn-sm" href="/os">Acompanhar</a>
    </div>
  </div>

  <!-- Compras -->
  <div class="card">
    <div class="label">Compras</div>
    <div style="font-size:22px; font-weight:900; margin-top:6px;">
      Solicita√ß√µes
    </div>
    <div class="muted" style="margin-top:6px;">
      Criar e acompanhar solicita√ß√µes
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;">
      <span class="pill-tag pill-blue">
        Abertas: <%= (cards?.compras_abertas ?? 0) %>
      </span>
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:14px;">
      <a class="btn btn-green btn-sm" href="/solicitacoes/nova">
        Fazer solicita√ß√£o
      </a>
      <a class="btn btn-ghost btn-sm" href="/solicitacoes">
        Ver solicita√ß√µes
      </a>
      <a class="btn btn-ghost btn-sm" href="/compras">
        Compras
      </a>
    </div>
  </div>

  <!-- Estoque -->
  <div class="card">
    <div class="label">Estoque</div>
    <div style="font-size:22px; font-weight:900; margin-top:6px;">
      Controle
    </div>
    <div class="muted" style="margin-top:6px;">
      Itens cadastrados e movimenta√ß√µes
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;">
      <span class="pill-tag pill-gray">
        Itens: <%= (cards?.itens_estoque ?? 0) %>
      </span>
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:14px;">
      <a class="btn btn-green btn-sm" href="/estoque">
        Ver estoque
      </a>
      <a class="btn btn-ghost btn-sm" href="/estoque/novo">
        Cadastrar item
      </a>
    </div>
  </div>

  <!-- üîß MOTORES -->
  <div class="card">
    <div class="label">Motores</div>
    <div style="font-size:22px; font-weight:900; margin-top:6px;">
      Controle de Rebobinamento
    </div>
    <div class="muted" style="margin-top:6px;">
      Acompanhamento de motores enviados
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;">
      <span class="pill-tag <%= (cards?.motores_conserto ?? 0) > 0 ? 'pill-amber' : 'pill-green' %>">
        Em conserto: <%= (cards?.motores_conserto ?? 0) %>
      </span>

      <% if ((cards?.motores_conserto ?? 0) > 0) { %>
        <span class="pill-tag pill-gray">
          Tempo m√©dio: <%= cards.motores_tempo_medio ?? 0 %> dias
        </span>
      <% } %>
    </div>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:14px;">
      <a class="btn btn-green btn-sm" href="/motores">
        Ver motores
      </a>
      <a class="btn btn-ghost btn-sm" href="/motores/new">
        Cadastrar
      </a>
    </div>
  </div>

</div>
