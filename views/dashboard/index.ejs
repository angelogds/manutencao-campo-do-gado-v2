<% layout('layout') %>

<div class="page-head">
  <div>
    <h1>Dashboard</h1>
    <p class="muted">Painel Operacional da Manutenção</p>
  </div>
</div>

<div class="grid-2" style="grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px;">

  <!-- ORDEM DE SERVIÇO -->
  <div class="card">
    <div class="label">Ordem de Serviço</div>
    <div style="font-size:22px; font-weight:900; margin-top:6px;">
      <%= cards.os_abertas %> em andamento
    </div>
    <div style="margin-top:14px;">
      <a class="btn btn-green btn-sm" href="/os">
        Acompanhar OS
      </a>
    </div>
  </div>

  <!-- MOTORES -->
  <div class="card">
    <div class="label">Motores</div>

    <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
      <span class="pill-tag pill-green">
        Na empresa: <%= cards.motores_empresa %>
      </span>

      <% if (cards.motores_conserto > 0) { %>
        <span class="pill-tag pill-amber">
          Em conserto: <%= cards.motores_conserto %>
        </span>
      <% } else { %>
        <span class="pill-tag pill-green">
          Nenhum em conserto
        </span>
      <% } %>
    </div>

    <div style="margin-top:14px;">
      <a class="btn btn-green btn-sm" href="/motores">
        Ver motores
      </a>
    </div>
  </div>

</div>

<!-- PREVENTIVAS -->
<div class="card" style="margin-top:18px;">
  <div class="label">Preventivas Programadas</div>

  <% if (preventivas.length === 0) { %>
    <div class="muted" style="margin-top:10px;">
      Nenhuma preventiva pendente.
    </div>
  <% } else { %>

    <div class="table-wrap" style="margin-top:12px;">
      <table class="table">
        <thead>
          <tr>
            <th>Equipamento</th>
            <th>Responsável</th>
            <th>Data</th>
            <th>Status</th>
            <th>Observação</th>
          </tr>
        </thead>
        <tbody>
          <% preventivas.forEach(p => { %>
            <tr>
              <td><strong><%= p.equipamento_nome || '-' %></strong></td>
              <td><%= p.responsavel || '-' %></td>
              <td><%= p.data_prevista || '-' %></td>
              <td>
                <% if (p.status === 'pendente') { %>
                  <span class="pill-tag pill-blue">Programada</span>
                <% } else if (p.status === 'em_andamento') { %>
                  <span class="pill-tag pill-amber">Em andamento</span>
                <% } else if (p.status === 'atrasada') { %>
                  <span class="pill-tag pill-amber">Atrasada</span>
                <% } %>
              </td>
              <td><%= p.observacao || '-' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

  <% } %>
</div>

<!-- ESCALA -->
<div class="card" style="margin-top:18px;">
  <div class="label">Escala da Semana</div>

  <% if (escala) { %>
    <div style="margin-top:10px;">
      <strong>Turno Dia:</strong> <%= escala.turno_dia || '-' %>
    </div>
    <div style="margin-top:6px;">
      <strong>Turno Noite:</strong> <%= escala.turno_noite || '-' %>
    </div>
  <% } else { %>
    <div class="muted">Escala não disponível.</div>
  <% } %>
</div>
