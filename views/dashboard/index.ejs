<% layout('layout') %>

<div class="page-head">
  <div>
    <h1>Dashboard</h1>
    <p class="muted">Painel Operacional da Manutenção</p>
  </div>
</div>

<div style="display:grid; grid-template-columns: 1.2fr 1fr; gap:16px; align-items:start;">

  <!-- LADO ESQUERDO (cards pequenos) -->
  <div style="display:grid; grid-template-columns: repeat(2,1fr); gap:14px;">

    <!-- OS -->
    <div class="card">
      <div class="label">Ordem de Serviço</div>
      <div style="font-size:22px; font-weight:900; margin-top:6px;">
        <%= cards.os_abertas %> em andamento
      </div>

      <div style="margin-top:14px;">
        <a class="btn btn-green btn-sm" href="/os">
          Acompanhar OS
        </a>
      </div>
    </div>

    <!-- ESCALA -->
    <div class="card">
      <div class="label">Escala da Semana</div>

      <% if (escala) { %>
        <div style="margin-top:10px;">
          <strong>Turno Dia:</strong><br>
          <%= escala.turno_dia || '-' %>
        </div>

        <div style="margin-top:10px;">
          <strong>Turno Noite:</strong><br>
          <%= escala.turno_noite || '-' %>
        </div>
      <% } else { %>
        <div class="muted" style="margin-top:10px;">
          Escala não disponível.
        </div>
      <% } %>
    </div>

    <!-- MOTORES -->
    <div class="card">
      <div class="label">Motores</div>

      <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
        <span class="pill-tag pill-green">
          Na empresa: <%= cards.motores_empresa %>
        </span>

        <% if (cards.motores_conserto > 0) { %>
          <span class="pill-tag pill-amber">
            Em conserto: <%= cards.motores_conserto %>
          </span>
        <% } else { %>
          <span class="pill-tag pill-green">
            Nenhum em conserto
          </span>
        <% } %>
      </div>

      <div style="margin-top:14px;">
        <a class="btn btn-green btn-sm" href="/motores">
          Ver motores
        </a>
      </div>
    </div>

    <!-- EQUIPAMENTOS -->
    <div class="card">
      <div class="label">Equipamentos</div>

      <div style="font-size:22px; font-weight:900; margin-top:6px;">
        <%= cards.equipamentos ?? 0 %> ativos
      </div>

      <div style="margin-top:14px;">
        <a class="btn btn-green btn-sm" href="/equipamentos">
          Ver equipamentos
        </a>
      </div>
    </div>

  </div>

  <!-- LADO DIREITO (PREVENTIVAS GRANDE) -->
  <div class="card" style="min-height:420px;">
    <div class="label">Preventivas Programadas</div>

    <% if (!preventivas || preventivas.length === 0) { %>
      <div class="muted" style="margin-top:16px;">
        Nenhuma preventiva pendente.
      </div>
    <% } else { %>

      <div class="table-wrap" style="margin-top:14px; max-height:500px; overflow:auto;">
        <table class="table">
          <thead>
            <tr>
              <th>Equipamento</th>
              <th>Resp.</th>
              <th>Data</th>
              <th>Status</th>
              <th>Obs</th>
            </tr>
          </thead>
          <tbody>
            <% preventivas.forEach(p => { %>
              <tr>
                <td><strong><%= p.equipamento_nome || '-' %></strong></td>
                <td><%= p.responsavel || '-' %></td>
                <td><%= p.data_prevista || '-' %></td>
                <td>
                  <% if (p.status === 'pendente') { %>
                    <span class="pill-tag pill-blue">Programada</span>
                  <% } else if (p.status === 'em_andamento') { %>
                    <span class="pill-tag pill-amber">Em andamento</span>
                  <% } else if (p.status === 'atrasada') { %>
                    <span class="pill-tag pill-amber">Atrasada</span>
                  <% } %>
                </td>
                <td class="td-clip"><%= p.observacao || '-' %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

    <% } %>
  </div>

</div>
